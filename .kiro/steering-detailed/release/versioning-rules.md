# バージョニング共通ルール

## 🎯 基本方針

全プロジェクトで**セマンティックバージョニング（SemVer）**を採用し、一貫したバージョン管理を行います。

## 📋 セマンティックバージョニング

### バージョン形式
```
MAJOR.MINOR.PATCH
例: 1.2.3
```

### バージョン種別

#### MAJOR（破壊的変更）
- 既存APIの削除・変更
- 設定ファイル形式の変更
- 依存関係の大幅変更
- 動作の根本的変更

**例**:
- 既存オプションの削除
- 設定ファイル構造の変更
- Python最小バージョンの引き上げ

#### MINOR（機能追加）
- 新機能の追加
- 新しいオプションの追加
- 依存パッケージの追加
- 非推奨化（deprecation）

**例**:
- 新しいコマンドオプション追加
- 新しい通知方式の追加
- 新しい設定項目の追加

#### PATCH（バグ修正・小改善）
- バグ修正
- ドキュメント修正
- パフォーマンス改善
- エラーメッセージ改善
- 内部リファクタリング

**例**:
- 計算ロジックのバグ修正
- README.mdの改善
- ログ出力の追加

## 🔍 境界線ケースの判定

### 判定が難しいケース

#### 表示件数のデフォルト変更
**判定**: PATCH
**理由**: ユーザー体験の小改善、オプションで従来の動作も可能

#### 新しいオプション追加
**判定**: MINOR
**理由**: 機能拡張（既存動作は変わらない）

#### 既存オプションの非推奨化
**判定**: MINOR
**理由**: まだ動作する、警告を表示

#### 内部リファクタリング
**判定**: PATCH
**理由**: ユーザーには見えない

#### テストの追加のみ
**判定**: なし（バージョン上げない）
**理由**: 開発者向け改善

#### CI/CDの導入
**判定**: なし（バージョン上げない）
**理由**: 開発者向け改善

#### README.mdの大幅な改善
**判定**: PATCH
**理由**: ドキュメント修正

#### エラーメッセージの改善
**判定**: PATCH
**理由**: ユーザー体験の改善

#### パフォーマンス改善（2倍高速化）
**判定**: PATCH
**理由**: 機能追加ではない

#### 新しい依存パッケージの追加
**判定**: MINOR
**理由**: 環境への影響がある

#### 依存パッケージの削除
**判定**: MAJOR
**理由**: 破壊的変更の可能性

## 📁 バージョン管理ファイル

### version.txt
```
1.2.3
```

### src/{project}/__init__.py
```python
__version__ = "1.2.3"
```

### setup.py
```python
version = (Path(__file__).parent / "version.txt").read_text().strip()
```

### .kiro/steering/project-config.yml
```yaml
versioning:
  scheme: "semver"
  current_version: "1.2.3"
```

## 🔄 バージョンアップ手順

### 1. バージョン決定
- 変更内容を分析
- SemVerルールに従って判定
- 境界線ケースは慎重に検討

### 2. ファイル更新（必須4ファイル）
```bash
# 1. version.txt
echo "1.2.4" > version.txt

# 2. src/{project}/__init__.py
sed -i 's/__version__ = ".*"/__version__ = "1.2.4"/' src/{project}/__init__.py

# 3. docs/CHANGELOG.md
# [Unreleased] を [1.2.4] - YYYY-MM-DD に変更

# 4. .kiro/steering/project-config.yml
# current_version を更新
```

### 3. 整合性確認
```bash
# バージョン整合性チェック
python scripts/check_version_consistency.py
```

### 4. タグ作成
```bash
git tag v1.2.4
git push origin v1.2.4
```

## 📊 バージョン履歴管理

### CHANGELOG.md形式
```markdown
# Changelog

## [Unreleased]

## [1.2.4] - 2025-01-05
### Fixed
- 通知送信時のエラーハンドリングを改善

### Added
- Slack通知にアイコン設定を追加

## [1.2.3] - 2025-01-01
### Fixed
- 設定ファイル読み込み時のバグを修正
```

### リリースノート生成
```bash
# 自動生成スクリプト
python scripts/generate_release_notes.py v1.2.4
```

## 🎯 プロジェクト固有の調整

各プロジェクトは以下を調整可能：
- 初期バージョン（通常は1.0.0）
- プレリリース版の命名規則
- 開発版の管理方法

### プロジェクト固有の境界線ケース

各プロジェクトで特有の判定ケースを定義：

#### Komon固有
- 監視閾値のデフォルト変更: PATCH
- 新しい監視項目の追加: MINOR
- アドバイス内容の変更: PATCH

#### Okina固有
- 通知メッセージの改善: PATCH
- 新しい通知プラットフォーム追加: MINOR
- 差分検知ロジックの改善: PATCH

## 🚨 注意事項

### バージョンアップ時の必須チェック
- [ ] 4つのファイル全てを更新
- [ ] バージョン整合性を確認
- [ ] CHANGELOGを更新
- [ ] テストが全てパス
- [ ] ドキュメントが最新

### よくある間違い
- ❌ version.txtのみ更新
- ❌ __init__.pyを忘れる
- ❌ CHANGELOGの更新忘れ
- ❌ project-config.ymlの更新忘れ

## 🎯 適用プロジェクト

- ✅ Komon
- ✅ Okina
- 🔄 今後の新プロジェクト全て